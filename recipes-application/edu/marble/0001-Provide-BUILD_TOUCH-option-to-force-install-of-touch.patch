From 0dd33b170a1472772fa4f088c8eb2b26ea2919fc Mon Sep 17 00:00:00 2001
From: Andreas Cord-Landwehr <cordlandwehr@kde.org>
Date: Sat, 2 Jan 2021 17:20:53 +0100
Subject: [PATCH] Provide BUILD_TOUCH option to force install of touch variant

Otherwise the executable is getting missed during packaging.
---
 CMakeLists.txt                      |  4 ++++
 src/apps/marble-maps/CMakeLists.txt | 10 +++++++---
 2 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 550882eb3..0a2227bd0 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -77,6 +77,10 @@ include( MarbleMacros )
 # if this option is set, srtm.jpg will not be installed but the generated tiles instead
 option(MOBILE "Create a Marble version optimized for handheld devices")
 
+####################################################
+# Provide opt-in switch for mobile variant, which is not only useful for Android.
+option(BUILD_TOUCH "Build touch-friendly Marble version (on Android this option is bypassed)" OFF)
+
 ####################################################
 # Build a D-Bus interface for the Marble widget
 # This is disabled by default for all win32, apple and Android
diff --git a/src/apps/marble-maps/CMakeLists.txt b/src/apps/marble-maps/CMakeLists.txt
index 3ecb48b4d..6ba8b8915 100644
--- a/src/apps/marble-maps/CMakeLists.txt
+++ b/src/apps/marble-maps/CMakeLists.txt
@@ -39,6 +39,10 @@ target_link_libraries (
     marble-maps
     marbledeclarative
 )
-
-FILE(GLOB QML_FILES *.qml)
-add_custom_target(marble-maps_resources ALL SOURCES ${QML_FILES} package/AndroidManifest.xml)
+if(ANDROID)
+    FILE(GLOB QML_FILES *.qml)
+    add_custom_target(marble-maps_resources ALL SOURCES ${QML_FILES} package/AndroidManifest.xml)
+elseif(BUILD_TOUCH)
+    install(TARGETS marble-maps RUNTIME DESTINATION bin)
+    install(PROGRAMS org.kde.marble.maps.desktop DESTINATION ${KDE_INSTALL_APPDIR})
+endif()
-- 
2.27.0

